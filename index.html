<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simple Form - Live on Cloudflare</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 30px auto; padding: 20px; background: #f0f4f8; }
    h1, h2 { color: #003087; text-align: center; } /* Axis blue */
    form, #admin { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 25px; }
    label { display: block; margin: 15px 0 6px; font-weight: bold; color: #333; }
    input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-size: 16px; }
    button { background: #003087; color: white; padding: 14px; border: none; border-radius: 6px; cursor: pointer; font-size: 18px; width: 100%; margin-top: 15px; }
    button:hover { background: #002060; }
    #toggle { background: #005566; margin-bottom: 20px; }
    .entry { border-bottom: 1px solid #eee; padding: 12px 0; font-size: 15px; }
    .entry strong { color: #003087; }
    #list { min-height: 100px; }
  </style>
</head>
<body>

  <button id="toggle">Admin View (Live Submissions) Dekho</button>

  <div id="formView">
    <h1>Apni Details Bharo</h1>
    <form id="myForm">
      <label>Full Name</label>
      <input type="text" id="name" required>

      <label>Mobile Number (10 digits)</label>
      <input type="tel" id="mobile" pattern="[0-9]{10}" required placeholder="98xxxxxxxx">

      <label>Date of Birth</label>
      <input type="date" id="dob" required>

      <button type="submit">Submit Karo</button>
    </form>
  </div>

  <div id="adminView" style="display:none;">
    <h2>Live Entries (Har 5 sec update hota hai)</h2>
    <div id="list">Abhi koi entry nahi... Submit kar ke dekho!</div>
  </div>

  <script>
    const form = document.getElementById('myForm');
    const toggle = document.getElementById('toggle');
    const formView = document.getElementById('formView');
    const adminView = document.getElementById('adminView');
    const list = document.getElementById('list');

    let pollingInterval = null;

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = {
        name: document.getElementById('name').value.trim(),
        mobile: document.getElementById('mobile').value.trim(),
        dob: document.getElementById('dob').value,
        time: new Date().toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' })
      };

      try {
        const res = await fetch('/api/submissions', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        if (res.ok) {
          alert('Submit ho gaya bhai! âœ…');
          form.reset();
        } else {
          alert('Kuch gadbad ho gayi, try again');
        }
      } catch (err) {
        alert('Error: ' + err.message);
      }
    });

    toggle.addEventListener('click', () => {
      if (formView.style.display !== 'none') {
        formView.style.display = 'none';
        adminView.style.display = 'block';
        toggle.textContent = 'Form Bharne Wapas Jao';
        loadData(); // pehli baar load
        pollingInterval = setInterval(loadData, 5000); // har 5 sec
      } else {
        formView.style.display = 'block';
        adminView.style.display = 'none';
        toggle.textContent = 'Admin View (Live Submissions) Dekho';
        if (pollingInterval) clearInterval(pollingInterval);
      }
    });

    async function loadData() {
      try {
        const res = await fetch('/api/submissions');
        const subs = await res.json();
        if (subs.length === 0) {
          list.innerHTML = '<p>Abhi tak koi submission nahi aaya.</p>';
        } else {
          list.innerHTML = subs.map(s => `
            <div class="entry">
              <strong>Name:</strong> ${s.name}<br>
              <strong>Mobile:</strong> ${s.mobile}<br>
              <strong>DOB:</strong> ${s.dob}<br>
              <small>${s.time}</small>
            </div>
          `).join('');
        }
      } catch (err) {
        list.innerHTML = '<p>Error loading data...</p>';
      }
    }
  </script>
</body>
</html>
